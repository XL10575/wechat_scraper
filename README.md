# 微信公众号文章下载工具 🚀

一个功能强大的微信公众号文章自动化下载、转换和上传工具，支持智能分类、自动更新、飞书知识库集成等功能。

![版本](https://img.shields.io/badge/版本-v2.1-blue)
![Python](https://img.shields.io/badge/Python-3.8+-green)
![平台](https://img.shields.io/badge/平台-Windows-lightgrey)

## ✨ 主要功能

### 📥 文章下载功能
- **单篇下载**：支持单个微信文章URL下载为PDF/DOCX
- **批量下载**：一次性处理多个URL，支持文件导入
- **自动监控**：实时监控剪贴板，自动识别并下载微信文章
- **智能去重**：自动检测并跳过重复文章

### 🤖 自动化功能
- **RO自动更新**：定时自动收集仙境传说RO公众号新文章
- **定时器功能**：支持自定义时间间隔的自动更新
- **启动自动化**：应用启动时自动执行更新检查

### 📚 飞书知识库集成
- **一键上传**：自动上传文章到飞书云文档和知识库
- **智能分类**：根据文章标题关键词自动分类到不同目录
- **OAuth认证**：安全的飞书API访问机制

### 🔍 链接收集功能
- **公众号搜索**：搜索并关注目标公众号
- **文章收集**：批量收集指定时间范围内的所有文章
- **数据导出**：支持CSV格式导出和批量下载

## 🛠️ 安装与配置

### 环境要求
- **Python 3.8+**
- **Chrome浏览器** (用于文章下载)
- **Windows 10/11** (推荐)

### 快速安装

1. **克隆项目**
```bash
git clone https://github.com/your-repo/wechat-scraper.git
cd wechat-scraper
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **启动程序**
```bash
python main.py
# 或者直接运行GUI
python wechat_gui.py
```

### 飞书配置（可选）

如需使用飞书功能，请：

1. **获取飞书应用凭证**
   - 访问 [飞书开发者后台](https://open.feishu.cn/)
   - 创建企业自建应用
   - 获取 `App ID` 和 `App Secret`

2. **配置权限**
   - 云文档权限：`drive:drive`
   - 知识库权限：`wiki:wiki`

3. **OAuth认证**
   - 在设置页面输入应用凭证
   - 点击"OAuth认证"完成授权

## 📖 使用指南

### 🚀 快速开始

#### 方式一：单篇文章下载
1. 打开"单篇下载"页签
2. 粘贴微信文章URL
3. 选择格式（PDF/DOCX）
4. 点击"开始下载"

#### 方式二：批量下载
1. 打开"批量下载"页签
2. 输入多个URL（每行一个）
3. 或点击"导入文件"加载URL列表
4. 点击"开始批量下载"

#### 方式三：自动监控
1. 打开"自动下载"页签
2. 勾选"启用自动下载"
3. 程序将监控剪贴板，自动下载微信文章

### 🤖 RO自动更新设置

#### 基础配置
1. 打开"RO自动更新"页签
2. 点击"登录微信公众号"
3. 扫码登录（二维码会自动弹出）
4. 搜索"仙境传说RO新启航"公众号

#### 手动更新
- 点击"🚀 立即执行更新"进行一次性更新

#### 定时自动更新
1. 勾选"启用定时更新"
2. 设置更新间隔（分钟）
3. 程序将自动定时检查新文章

#### 日期管理
- **查看上次更新时间**：显示在状态栏
- **重置更新日期**：点击"重置日期"回到初始状态
- **查看更新日志**：点击"查看日志"查看详细记录

### 📚 飞书知识库功能

#### OAuth认证设置
1. 进入"设置"页签
2. 输入飞书应用的App ID和App Secret
3. 点击"OAuth认证"
4. 在弹出页面完成授权

#### 智能分类配置
1. 在设置中配置"知识库位置映射"
2. 添加关键词和对应的知识库位置
3. 系统将根据文章标题自动分类

**示例配置：**
```
关键词: 更新公告 → 目标位置: 游戏更新目录
关键词: 热点问题 → 目标位置: 问题汇总目录
关键词: 活动 → 目标位置: 游戏活动目录
```

#### 测试功能
- **智能分类测试**：输入标题测试分类结果
- **上传测试**：验证文件上传功能是否正常

### 🔍 链接收集器

#### 收集文章链接
1. 打开"链接收集器"页签
2. 登录微信公众号（如未登录）
3. 搜索目标公众号
4. 设置收集参数：
   - 文章数量限制
   - 开始/结束日期
5. 点击"开始收集"

#### 导出和使用
- **导出CSV**：将收集的链接保存为Excel文件
- **导入批量下载**：一键导入到批量下载功能
- **清空数据**：清理当前收集的数据

## ⚙️ 高级设置

### 智能分类关键词配置

智能分类基于文章标题中的关键词进行自动分类：

```json
{
  "keywords": ["更新公告", "维护通知"],
  "wiki_url": "https://xxx.feishu.cn/wiki/xxx",
  "as_subpage": true
}
```

### 输出目录设置
- **本地文件存储**：可自定义下载文件保存位置
- **自动命名**：基于文章标题自动生成文件名
- **格式支持**：PDF（推荐）和DOCX格式

### 浏览器设置
- **无头模式**：后台运行，不显示浏览器窗口
- **自动驱动**：自动下载和管理ChromeDriver
- **错误重试**：下载失败时自动重试

## 🔧 故障排除

### 常见问题

#### 1. 下载失败
**可能原因：**
- 网络连接问题
- 微信文章需要登录访问
- Chrome浏览器未正确安装

**解决方案：**
- 检查网络连接
- 确保Chrome浏览器已安装
- 查看日志详细错误信息

#### 2. 飞书上传失败
**可能原因：**
- OAuth令牌过期
- 权限不足
- 网络连接问题

**解决方案：**
- 重新进行OAuth认证
- 检查应用权限配置
- 查看飞书API错误信息

#### 3. 自动更新不工作
**可能原因：**
- 登录状态过期
- 公众号搜索失败
- 定时器设置错误

**解决方案：**
- 重新登录微信公众号
- 手动测试公众号搜索
- 检查定时器间隔设置

#### 4. 重复文件问题
**现象：** 提示跳过下载但日志显示失败

**说明：** 这是正常行为！系统检测到重复文件时会智能跳过，这不是错误。

### 日志查看
- **实时日志**：GUI界面底部显示运行状态
- **详细日志**：检查 `logs/` 目录下的日志文件
- **更新日志**：RO自动更新页面的"查看日志"功能

## 📊 功能特色

### 🧠 智能重复检测
- **多层检测**：云文档 + 知识库双重检测
- **标题匹配**：基于文章标题的精确匹配
- **自动跳过**：检测到重复时自动跳过下载

### 📈 批量处理能力
- **并发下载**：支持多文章同时处理
- **进度显示**：实时显示处理进度
- **错误恢复**：单个失败不影响整体处理

### 🎯 精准分类
- **关键词匹配**：基于预设关键词自动分类
- **灵活配置**：支持自定义分类规则
- **默认处理**：未匹配时使用默认位置

## 📋 版本更新

### v2.1 最新功能
- ✅ 定时器自动更新功能
- ✅ 智能重复检测优化
- ✅ 日志系统完善
- ✅ GUI界面优化

### v2.0 主要功能
- ✅ RO自动更新系统
- ✅ 飞书知识库集成
- ✅ 智能分类功能
- ✅ OAuth认证系统

### v1.0 基础功能
- ✅ 单篇/批量下载
- ✅ 自动剪贴板监控
- ✅ 链接收集器
- ✅ 基础GUI界面

## ⚠️ 注意事项

### 使用限制
1. **法律合规**：仅下载有授权的公众号文章
2. **频率限制**：避免过于频繁的请求
3. **版权尊重**：下载的文章仅供个人学习使用

### 技术限制
1. **浏览器依赖**：需要Chrome浏览器环境
2. **网络要求**：需要稳定的网络连接
3. **系统支持**：主要支持Windows系统

### 安全建议
1. **凭证安全**：妥善保管飞书应用凭证
2. **定期更新**：定期更新依赖包版本
3. **备份数据**：重要数据请及时备份

## 🤝 支持与反馈

### 技术支持
- **问题反馈**：遇到问题请查看日志并描述详细情况
- **功能建议**：欢迎提出新功能需求
- **使用交流**：分享使用经验和技巧

### 更新计划
- 🔄 性能优化和错误修复
- 🆕 新增更多公众号支持
- 📱 移动端适配考虑
- ☁️ 云端部署方案

---

**祝你使用愉快！** 🎉

如有任何问题，请查看日志信息或提供详细的错误描述以便快速解决。