# 🔐 OAuth认证管理使用指南

## 📖 功能概述

OAuth认证管理功能让你可以轻松管理飞书API的认证状态，解决认证过期导致的上传失败问题。

## ❓ 什么时候需要重新认证

### 常见的认证过期症状：
- ❌ SSL握手失败：`handshake failed; returned -1, SSL error code 1, net_error -101`
- ❌ 401认证错误：`Unauthorized`
- ❌ 文件上传失败，日志显示认证相关错误
- ⚠️  OAuth状态显示"token已过期"

## 🚀 使用步骤

### 1. 检查认证状态

1. 打开微信文章下载工具
2. 点击"⚙️ 设置"选项卡
3. 找到"🔐 OAuth认证管理"区域
4. 点击"🔍 检查状态"按钮

### 状态说明：
- ✅ **OAuth认证正常，token有效** - 可以正常使用
- ⚠️  **OAuth token已过期，需要重新认证** - 需要重新认证
- ❌ **未找到OAuth认证信息** - 需要进行首次认证

### 2. 重新认证流程

当显示需要重新认证时：

1. 点击"🔄 重新认证"按钮
2. 程序会自动打开浏览器
3. 在浏览器中完成飞书OAuth授权
4. 授权成功后自动返回程序
5. 认证状态会更新为"✅ OAuth重新认证成功！"

### 3. 认证步骤详解

#### 浏览器授权流程：
1. 🌐 **自动打开浏览器** - 程序会打开飞书授权页面
2. 📱 **飞书登录** - 使用你的飞书账号登录
3. ✅ **授权确认** - 确认授权应用访问你的飞书数据
4. 🔄 **自动回调** - 授权完成后自动跳转回程序
5. 💾 **保存认证** - 程序自动保存新的认证信息

## 🔧 其他功能

### 撤销认证
- 点击"❌ 撤销认证"按钮
- 会删除所有本地认证信息
- 需要重新进行完整认证流程

### 状态检查
- 点击"🔍 检查状态"按钮
- 实时检查当前认证状态
- 验证token是否仍然有效

## 📝 认证文件

认证信息保存在：`feishu_oauth_tokens.json`

**文件内容示例：**
```json
{
  "access_token": "u-dQlJxqgdx2.a2ygTcPVvRgl035bxg4wXUi000hG8aIIz",
  "refresh_token": "ur-cUDrK1TBFegXBptV4M0.ZYl01Lb1g4aPi2001hG8aFFP",
  "expires_in": 6900,
  "token_type": "Bearer",
  "scope": null,
  "created_at": 1749466041,
  "app_id": "cli_a8c822312a75901c"
}
```

## ⚠️ 注意事项

1. **网络连接**：认证过程需要稳定的网络连接
2. **浏览器要求**：确保系统默认浏览器可以正常使用
3. **飞书账号**：需要有效的飞书账号并有相应权限
4. **防火墙设置**：确保localhost:8080端口可以访问（认证回调使用）

## 🐛 故障排除

### 问题1：浏览器无法打开
**原因**：系统默认浏览器设置问题
**解决**：手动复制认证URL到浏览器中

### 问题2：授权完成但程序无响应
**原因**：本地回调服务器可能被阻止
**解决**：
1. 检查防火墙设置
2. 确保8080端口未被占用
3. 重新启动程序后再试

### 问题3：认证成功但仍提示过期
**原因**：可能是时区或系统时间问题
**解决**：
1. 检查系统时间是否正确
2. 点击"🔍 检查状态"刷新状态
3. 必要时重新认证

### 问题4：SSL握手失败持续出现
**原因**：网络或代理设置问题
**解决**：
1. 检查网络连接
2. 暂时关闭VPN或代理
3. 尝试更换网络环境

## 📊 认证状态监控

程序会在以下情况自动检查认证状态：
- 启动时自动检查
- 上传文件前检查
- 用户手动点击检查按钮时
- 认证操作完成后自动重新检查

## 🎯 最佳实践

1. **定期检查**：建议每周检查一次认证状态
2. **及时更新**：发现token过期立即重新认证
3. **备份认证**：重要项目可备份认证文件
4. **监控日志**：注意日志中的认证相关错误信息

---

🎉 现在你可以轻松管理OAuth认证，确保飞书上传功能始终正常工作！ 